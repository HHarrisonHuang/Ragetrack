<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ragetrack - Capture the Flag</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üèéÔ∏è</text></svg>">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Arial', sans-serif;
      overflow: hidden;
      background: #000;
    }
    #app {
      width: 100vw;
      height: 100vh;
    }
    #ui {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 100;
    }
    #lobby {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('/images/lobbyBackground.jpeg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      pointer-events: all;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
    }
    #lobbyContent {
      text-align: center;
      margin-top: auto;
      margin-bottom: 100px;
    }
    #lobbyButtons {
      display: flex;
      gap: 16px;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    .lobby-secondary-btn {
      background: rgba(0,0,0,0.45);
      border: 1px solid rgba(255,255,255,0.25);
      color: white;
      padding: 10px 18px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      letter-spacing: 0.5px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
      transition: transform 0.15s, background 0.15s;
    }
    .lobby-secondary-btn:hover {
      transform: scale(1.03);
      background: rgba(0,0,0,0.6);
    }
    #lobby h1 {
      display: none; /* Title is in background */
    }
    #lobby p {
      font-size: 1.2em;
      margin-bottom: 30px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    }
    #joinButton {
      background: transparent;
      border: none;
      cursor: pointer;
      padding: 0;
      margin: 10px;
    }
    #joinButton img {
      width: 200px;
      height: auto;
      transition: transform 0.2s;
    }
    #joinButton:hover img {
      transform: scale(1.05);
    }
    #joinButton:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    #joinButton:disabled img {
      opacity: 0.5;
    }
    #readyButton {
      background: transparent;
      border: none;
      cursor: pointer;
      padding: 0;
      margin: 10px;
    }
    #readyButton img {
      width: 200px;
      height: auto;
      transition: transform 0.2s;
    }
    #readyButton:hover img {
      transform: scale(1.05);
    }
    #readyButton:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    #readyButton:disabled img {
      opacity: 0.5;
    }
    #notReadyButton {
      background: transparent;
      border: none;
      cursor: pointer;
      padding: 0;
      margin: 10px;
    }
    #notReadyButton img {
      width: 200px;
      height: auto;
      transition: transform 0.2s;
    }
    #notReadyButton:hover img {
      transform: scale(1.05);
    }
    #returnToLobby img {
      transition: transform 0.2s;
    }
    #returnToLobby:hover img {
      transform: scale(1.05);
    }
    #gameInfo {
      position: absolute;
      top: 20px;
      left: 20px;
      color: white;
      background: rgba(0, 0, 0, 0.7);
      padding: 15px;
      border-radius: 5px;
      font-size: 14px;
      pointer-events: all;
    }
    #scoreboard {
      position: absolute;
      top: 20px;
      right: 20px;
      color: white;
      background: rgba(0, 0, 0, 0.7);
      padding: 15px;
      border-radius: 5px;
      font-size: 14px;
      pointer-events: all;
    }
    #soundButton {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      background: rgba(0, 0, 0, 0.7);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      color: white;
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: all;
      z-index: 200;
      transition: background 0.2s, transform 0.2s;
    }
    #soundButton:hover {
      background: rgba(0, 0, 0, 0.9);
      transform: scale(1.1);
    }
    #scoreboard {
      top: 80px;
    }
    .team-score {
      margin: 5px 0;
    }
    .red-team { color: #ff4444; }
    .blue-team { color: #4444ff; }
  </style>
</head>
<body>
  <div id="app"></div>
  <div id="ui">
    <div id="lobby">
      <div id="lobbyContent">
        <p>Capture the Flag</p>
        <div id="lobbyButtons">
          <button id="joinButton"><img src="/images/joinGameButton.png" alt="Join Game"></button>
          <!-- Starts a blank editor session (no map loaded) -->
          <button id="lobbyEditorBtn" class="lobby-secondary-btn">Map Editor</button>
        </div>
        <p id="playerCount" style="margin-top: 20px; font-size: 1em; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);">Click "Join Game" to start</p>
        <p id="connectionStatus" style="margin-top: 10px; font-size: 0.9em; color: #ccc; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);">Not connected</p>
        <div id="readySection" style="display: none; margin-top: 20px;">
          <button id="readyButton"><img src="/images/readyButton.png" alt="Ready"></button>
          <button id="notReadyButton" style="display: none;"><img src="/images/notReadyButton.png" alt="Not Ready"></button>
          <p id="readyStatus" style="margin-top: 10px; font-size: 1em; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);">Ready: <span id="readyCount">0</span>/<span id="totalPlayers">0</span></p>
        </div>
      </div>
    </div>
    <div id="gameInfo" style="display: none;">
      <div>Team: <span id="teamName"></span></div>
      <div>Players: <span id="currentPlayers">0</span>/<span id="maxPlayers">10</span></div>
      <div style="margin-top: 10px;">
        <button id="editorBtn" style="padding: 5px 10px; font-size: 12px;">Map Editor</button>
      </div>
    </div>
    <div id="respawnBtnOverlay" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000; pointer-events: all;">
      <button id="respawnBtn" style="padding: 20px 40px; font-size: 24px; font-weight: bold; background: rgba(255, 100, 100, 0.9); color: white; border: 3px solid white; border-radius: 10px; cursor: pointer; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5); transition: transform 0.2s, background 0.2s;">Back to Spawn</button>
    </div>
    <style>
      #respawnBtn:hover {
        transform: scale(1.1);
        background: rgba(255, 120, 120, 1) !important;
      }
    </style>
    <button id="soundButton" title="Toggle Music">üîä</button>
    <div id="scoreboard" style="display: none;">
      <div class="team-score red-team">Red: <span id="redScore">0</span></div>
      <div class="team-score blue-team">Blue: <span id="blueScore">0</span></div>
    </div>
    <div id="respawnOverlay" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0, 0, 0, 0.8); padding: 40px; border-radius: 10px; text-align: center; color: white; font-size: 24px;">
      <div style="margin-bottom: 10px;">üíÄ Eliminated!</div>
      <div>Respawning in <span id="respawnTimer">5</span>s</div>
    </div>
    <div id="gameEndOverlay" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000; pointer-events: all;">
      <div id="victoryBackground" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000 url('/images/victoryBackground.jpeg') center/cover no-repeat; z-index: 1;"></div>
      <div id="defeatBackground" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000 url('/images/defeatedBackground.png') center/cover no-repeat; z-index: 1;"></div>
      <div style="position: absolute; top: 65%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: white; z-index: 1001;">
        <h1 id="gameEndTitle" style="display: none;"></h1>
        <p id="gameEndMessage" style="font-size: 1.5em; margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);"></p>
        <div id="gameEndScores" style="font-size: 1.2em; margin-bottom: 30px; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);"></div>
        <button id="returnToLobby" style="background: transparent; border: none; cursor: pointer; padding: 0;">
          <img src="/images/backToLobbyButton.png" alt="Back to Lobby" style="width: 200px; height: auto; transition: transform 0.2s;">
        </button>
      </div>
    </div>
  </div>
  <script type="module" src="/src/main.js"></script>
  <script type="module">
    // Diagnostic: Check if main.js loaded
    window.addEventListener('error', (e) => {
      if (e.filename && e.filename.includes('main.js')) {
        console.error('‚ùå Error in main.js:', e.message, e.filename, e.lineno);
      }
    });
    
    // Check after a delay if main.js executed
    setTimeout(() => {
      if (!window.game) {
        console.warn('‚ö†Ô∏è Game not initialized after 2 seconds. Check for import errors above.');
      }
    }, 2000);
  </script>
</body>
</html>
